
@{
    ViewBag.Title = "CrearUsuario";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<body>
    <br />
    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">
        <div class="kt-content kt-grid__item kt-grid__item--fluid" id="kt_content">
            <div class="kt-portlet kt-portlet--mobile">
                <div class="kt-portlet__head">
                    <div class="kt-portlet__head-label">
                        <h3 class="kt-portlet__head-title">
                            Nuevo Usuario
                        </h3>
                    </div>
                    <div class="kt-portlet__head-toolbar">
                        <div class="kt-subheader__wrapper">

                            <a href="#" class="btn btn-secondary kt-margin-r-10" title="Cancelar" id="RegresarUsu">
                                <i class="la la-arrow-left"></i> <span class="kt-hidden-mobile">Regresar</span>
                            </a>
                            <a href="#" class="btn btn-secondary kt-margin-r-10" id="BtnRegistrarUsu" title="Registrar Usuario">
                                <i class="la la-refresh"></i> <span class="kt-hidden-mobile">Registrar</span>
                            </a>

                        </div>
                    </div>
                </div>
                <div class="kt-portlet__body">
                    <form class="kt-form" id="kt_form">
                        <fieldset id="SubmitFormx" autocomplete="off">
                            <div class="row">
                                <div class="col-xl-2"></div>
                                <div class="col-xl-8">
                                    <div class="kt-section kt-section--first">
                                        <div class="kt-section__body">
                                            <h3 class="kt-section__title kt-section__title-lg">
                                                Datos Generales:
                                            </h3>
                                            <div class="form-group row">
                                                <label class="col-3 col-form-label">Nombres (*)</label>
                                                <div class="col-9">
                                                    <input class="form-control" id="oNombres" type="text" name="oNombres" />
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label class="col-3 col-form-label">Apellidos (*)</label>
                                                <div class="col-9">
                                                    <input class="form-control" id="oApellidos" type="text" name="oApellidos" />
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label class="col-3 col-form-label">Email</label>
                                                <div class="col-9">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i class="la la-at"></i></span>
                                                        </div>
                                                        <input class="form-control" id="oEmail" type="text" name="oEmail" placeholder="Email" aria-describedby="basic-addon1" />

                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row">

                                                <label class="col-3 col-form-label">Rol de Usuario (*)</label>
                                                <div class="col-9">
                                                    @Html.DropDownList("oRoles", ViewBag.ListaRoles as SelectList, "", new { @class = "form-control", @name = "oRoles" })
                                                </div>
                                            </div>

                                            <div class="form-group row">

                                                <label class="col-3 col-form-label">Empresa (*)</label>
                                                <div class="col-9">
                                                    @Html.DropDownList("oCodEmpresa", ViewBag.ListarEmpresa as SelectList, "", new { @class = "form-control", @name = "oCodEmpresa" })
                                                </div>
                                            </div>

                                            <div class="form-group form-group-last row">
                                                <label class="col-3 col-form-label">Acceso de aplicación</label>
                                                <div class="col-9">
                                                    <div class="kt-checkbox-inline">
                                                        <label class="kt-checkbox kt-checkbox--brand">
                                                            <input type="checkbox" id="oActivoWEB" name="oActivoWEB" checked>
                                                            WEB ALPA <span></span>
                                                        </label>
                                                        <label class="kt-checkbox kt-checkbox--brand">
                                                            <input type="checkbox" id="oActivoAPP" name="oActivoAPP">
                                                            APP ALPA<span></span>
                                                        </label>
                                                    </div>
                                                    <span class="form-text text-muted">Seleccione los accesos necesarios.</span>
                                                </div>
                                            </div>
                                            <br />

                                        </div>
                                    </div>
                                    <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>
                                    <div class="kt-section">
                                        <div class="kt-section__body">
                                            <h3 class="kt-section__title kt-section__title-lg">
                                                Credenciales WEB/APP:
                                            </h3>

                                            <div class="form-group row">
                                                <label class="col-3 col-form-label">Código de Usuario (*)</label>
                                                <div class="col-9">
                                                    <input class="form-control" id="oCodUsuario" type="text" name="oCodUsuario" />
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label class="col-3 col-form-label">Contraseña (*)</label>
                                                <div class="col-9">
                                                    <input class="form-control" id="oContrasena" type="password" name="oContrasena" />
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>
                                    <div class="kt-section">
                                        <div class="kt-section__body">
                                            <h3 class="kt-section__title kt-section__title-lg">
                                                Opciones Especiales:
                                            </h3>

                                            <div class="form-group form-group-last row">
                                                <label class="col-3 col-form-label">Super Usuario</label>
                                                <div class="col-9">
                                                    <div class="kt-checkbox-inline">
                                                        <label class="kt-checkbox kt-checkbox--brand">
                                                            <input type="checkbox" id="oSuperUsuario" name="oSuperUsuario">
                                                            Activo <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-2"></div>
                            </div>
                        </fieldset>
                    </form>

                </div>
            </div>
        </div>
        <!-- end:: Content -->
    </div>
    <div id="progress" class="modal">
        <div class="center" style="position: fixed;top: 50%;left: 50%;-webkit-transform: translate(-50%, -50%);transform: translate(-50%, -50%);">
            <div class="kt-section__content kt-section__content--border">
                <div class="spinner-grow text-primary" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-secondary" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-success" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-danger" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-warning" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-info" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-light" role="status"> <span class="sr-only">Loading...</span> </div>
            </div>
        </div>
    </div>
</body>
<script src="../assets/vendors/general/jquery/dist/jquery.js" type="text/javascript"></script>
<script>
    $("#RegresarUsu").click("click", function () {
        window.location.href = "../Administracion/Usuarios";
    });

    function LimpiarDatos() {
        document.getElementById("oNombres").value = "";
        document.getElementById("oApellidos").value = "";
        document.getElementById("oEmail").value = "";
        document.getElementById("oCodUsuario").value = "";
        document.getElementById("oContrasena").value = "";
        document.getElementById("oRoles").value = 0;
        document.getElementById("oCodEmpresa").value = "";

        $("#oSuperUsuario").prop("checked", false);
        $("#oActivoWEB").prop("checked", true);
        $("#oActivoAPP").prop("checked", false);

    }

    $("#BtnRegistrarUsu").click(function () {
        var oMsg = "";

        if (document.getElementById("oNombres").value == "" || document.getElementById("oApellidos").value == "" ||
            document.getElementById("oCodUsuario").value == "" || document.getElementById("oContrasena").value == "" || document.getElementById("oRoles").value == 0) {
            oMsg = "Debe ingresar los datos obligatorios (*)";
        }

        if (oMsg != "") {
            swal(
                'Alerta!',
                oMsg,
            )
        }
        else {

            swal({
                title: 'Esta seguro de registrar el usuario?',
                showCancelButton: true,
                confirmButtonText: 'Si, registrar!',

            }).then(function (result) {
                if (result.value == true) {
                    $('#progress').show();
                    var datax = $("#SubmitFormx").serialize();
                    $.ajax({
                        url: '/Administracion/Registrarusuario',
                        type: 'post',
                        data: datax,
                        dataType: 'json',
                        success: function (result) {
                            $('#progress').hide();
                            if (result.EnableSuccess == true) {
                                LimpiarDatos();                                
                                swal(
                                    'Mensaje!',
                                    result.SuccessMsg,
                                )
                            }
                            else {
                                swal(
                                    'Alerta!',
                                    result.SuccessMsg,
                                )
                            }
                        },
                        error: function () {
                            console.log("fallo");
                            swal({
                                type: 'error',
                                title: result.SuccessMsg,
                                showConfirmButton: true,
                            });
                        }
                    });
                }
            });
        }
    });
</script>
