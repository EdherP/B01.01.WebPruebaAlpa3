@using Web_ALPA.Models.Entidad
@model List<Usuario>
@{
    ViewBag.Title = "EditarUsuario";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<body>
    <br />
    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">
        <div class="kt-content kt-grid__item kt-grid__item--fluid" id="kt_content">
            <div class="kt-portlet kt-portlet--mobile">
                <div class="kt-portlet__head">
                    <div class="kt-portlet__head-label">
                        <h3 class="kt-portlet__head-title">
                            Detalle de Usuario
                        </h3>
                    </div>
                    <div class="kt-portlet__head-toolbar">
                        <div class="kt-subheader__wrapper">
                            <a href="#" class="btn btn-secondary kt-margin-r-10" title="Cancelar" id="BtnRegresarEditUsu">
                                <i class="la la-arrow-left"></i> <span class="kt-hidden-mobile">Regresar</span>
                            </a>
                            <a href="#" class="btn btn-secondary kt-margin-r-10" id="BtnEditarUsu" title="Editar Usuario">
                                <i class="la la-refresh"></i> <span class="kt-hidden-mobile">Editar</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="kt-portlet__body">
                    <form class="kt-form" id="kt_form">
                        <fieldset id="SubmitFormx" autocomplete="off">
                            <div class="row">
                                <div class="col-xl-2"></div>
                                <div class="col-xl-8">
                                    @if (Model != null & Model.Count == 1)
                                    {
                                        <div class="kt-section kt-section--first">
                                            <div class="kt-section__body">

                                                <div class="form-group" style="display:none">
                                                    <input class="form-control" id="oCode" type="text" name="oCode" value=@Model[0].Code />
                                                    <input class="form-control form-control-sm" id="oTipoEstado" name="oTipoEstado" value="@ViewBag.oTipo" />
                                                </div>
                                                <h3 class="kt-section__title kt-section__title-lg">
                                                    Datos Generales:
                                                </h3>
                                                <div class="form-group row">
                                                    <label class="col-3 col-form-label">Código de Usuario (*)</label>
                                                    <div class="col-9">
                                                        @Html.TextBox("oCodUsuario", @Model[0].CodUsuario, "", new { @class = "form-control", @disabled = "disabled", @name = "oCodUsuario" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label class="col-3 col-form-label">Nombres (*)</label>
                                                    <div class="col-9">
                                                        @Html.TextBox("oNombres", @Model[0].Nombres, "", new { @class = "form-control", @disabled = "disabled", @name = "oNombres" })
                                                    </div>
                                                </div>

                                                <div class="form-group row">
                                                    <label class="col-3 col-form-label">Apellidos (*)</label>
                                                    <div class="col-9">

                                                        @Html.TextBox("oApellidos", @Model[0].Apellidos, "", new { @class = "form-control", @disabled = "disabled", @name = "oApellidos" })
                                                    </div>
                                                </div>

                                                <div class="form-group row">
                                                    <label class="col-3 col-form-label">Email</label>
                                                    <div class="col-9">
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <span class="input-group-text"><i class="la la-at"></i></span>
                                                            </div>
                                                            @Html.TextBox("oEmail", @Model[0].E_Mail, "", new { @class = "form-control", @disabled = "disabled", @name = "oEmail" })
                                                        </div>
                                                    </div>
                                                </div>

                                                <br />
                                                <div class="form-group row">

                                                    <label class="col-3 col-form-label">Rol de Usuario (*)</label>
                                                    <div class="col-9">
                                                        @Html.DropDownList("oRoles", ViewBag.ListaRoles as SelectList, "", new { @class = "form-control", @disabled = "disabled", @name = "oRoles" })
                                                    </div>
                                                </div>

                                                <div class="form-group form-group-last row">
                                                    <label class="col-3 col-form-label">Estado</label>
                                                    <div class="col-9">
                                                        <div class="kt-checkbox-inline">
                                                            <label class="kt-checkbox kt-checkbox--brand">

                                                                @if (@Model[0].U_FlagActivo == true)
                                                                {<input type="checkbox" id="oActivo" name="oActivo" checked="checked" disabled="disabled">}
                                                                else
                                                                {<input type="checkbox" id="oActivo" name="oActivo" disabled="disabled">}
                                                                Activo <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>

                                        <div class="kt-section">
                                            <div class="kt-section__body">
                                                <h3 class="kt-section__title kt-section__title-lg">
                                                    Accesos:
                                                </h3>

                                                <div class="form-group row">
                                                    <label class="col-3 col-form-label">WEB</label>
                                                    <div class="col-9">
                                                        <div class="kt-checkbox-inline">
                                                            <label class="kt-checkbox kt-checkbox--brand">

                                                                @if (@Model[0].U_Web == true)
                                                                {<input type="checkbox" id="oActivoWEB" name="oActivoWEB" checked="checked" disabled="disabled">}
                                                                else
                                                                {<input type="checkbox" id="oActivoWEB" name="oActivoWEB" disabled="disabled">}
                                                                Activo <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="form-group row">
                                                    <label class="col-3 col-form-label">APP</label>
                                                    <div class="col-9">
                                                        <div class="kt-checkbox-inline">
                                                            <label class="kt-checkbox kt-checkbox--brand">

                                                                @if (@Model[0].U_APP == true)
                                                                {<input type="checkbox" id="oActivoAPP" name="oActivoAPP" checked="checked" disabled="disabled">}
                                                                else
                                                                {<input type="checkbox" id="oActivoAPP" name="oActivoAPP" disabled="disabled">}
                                                                Activo <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>
                                        <div class="kt-section">
                                            <div class="kt-section__body">
                                                <h3 class="kt-section__title kt-section__title-lg">
                                                    Opciones Especiales:
                                                </h3>

                                                <div class="form-group form-group-last row">
                                                    <label class="col-3 col-form-label">Super Usuario</label>
                                                    <div class="col-9">
                                                        <div class="kt-checkbox-inline">
                                                            <label class="kt-checkbox kt-checkbox--brand">
                                                                @if (@Model[0].SuperUsuario == true)
                                                                {<input type="checkbox" id="oSuperUsuario" name="oSuperUsuario" checked="checked" disabled="disabled">}
                                                                else
                                                                {<input type="checkbox" id="oSuperUsuario" name="oSuperUsuario" disabled="disabled">}
                                                                Activo <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    }
                                </div>
                                <div class="col-xl-2"></div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <!-- end:: Content -->
    </div>
    <div id="progress" class="modal">
        <div class="center" style="position: fixed;top: 50%;left: 50%;-webkit-transform: translate(-50%, -50%);transform: translate(-50%, -50%);">
            <div class="kt-section__content kt-section__content--border">
                <div class="spinner-grow text-primary" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-secondary" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-success" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-danger" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-warning" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-info" role="status"> <span class="sr-only">Loading...</span> </div>
                <div class="spinner-grow text-light" role="status"> <span class="sr-only">Loading...</span> </div>
            </div>
        </div>
    </div>
</body>
<script src="../assets/vendors/general/jquery/dist/jquery.js" type="text/javascript"></script>
<script>
    $("#BtnRegresarEditUsu").click("click", function () {
        window.location.href = "../Administracion/Usuarios";
    });
    function BloquearDatos() {
        document.getElementById("oNombres").disabled = true;
        document.getElementById("oApellidos").disabled = true;
        document.getElementById("oEmail").disabled = true;
        document.getElementById("oRoles").disabled = true;
        document.getElementById("oActivo").disabled = true;
        document.getElementById("oActivoAPP").disabled = true;
        document.getElementById("oActivoWEB").disabled = true;
        document.getElementById("oSuperUsuario").disabled = true;

        var oBtn = document.getElementById('BtnEditarUsu');
        oBtn.innerHTML = '<i class="la la-refresh"></i> Editar';
        document.getElementById("oTipoEstado").value = "View";

    }
    $("#BtnEditarUsu").click("click", function () {
        var xTipoEstado = document.getElementById("oTipoEstado").value;

        if (xTipoEstado == "View") {

            document.getElementById("oNombres").disabled = false;
            document.getElementById("oApellidos").disabled = false;
            document.getElementById("oEmail").disabled = false;
            document.getElementById("oRoles").disabled = false;
            document.getElementById("oActivo").disabled = false;
            document.getElementById("oActivoAPP").disabled = false;
            document.getElementById("oActivoWEB").disabled = false;
            document.getElementById("oSuperUsuario").disabled = false;

            var oBtn = document.getElementById('BtnEditarUsu');
            oBtn.innerHTML = '<i class="la la-save"></i> Guardar';
            document.getElementById("oTipoEstado").value = "Edit";
        }

        if (xTipoEstado == "Edit") {
            var oMsg = "";

            if (document.getElementById("oNombres").value == "" || document.getElementById("oApellidos").value == "" || document.getElementById("oRoles").value == 0) {
                oMsg = "Debe ingresar los datos obligatorios (*)";
            }

            if (oMsg != "") {
                swal(
                    'Alerta!',
                    oMsg,
                )
            }
            else {

                swal({
                    title: 'Esta seguro de actualizar los datos del usuario?',
                    showCancelButton: true,
                    confirmButtonText: 'Si, actualizar!',

                }).then(function (result) {
                    if (result.value == true) {
                        $('#progress').show();
                        var datax = $("#SubmitFormx").serialize();
                        $.ajax({
                            url: '/Administracion/ActualizarUsuario',
                            type: 'post',
                            data: datax,
                            dataType: 'json',
                            success: function (result) {
                                if (result.EnableSuccess == true) {
                                    BloquearDatos();
                                    $('#progress').hide();

                                    swal({
                                        type: 'success',
                                        text: result.SuccessMsg,
                                        title: 'Mensaje!',
                                        showConfirmButton: true,
                                    });
                                }
                                else {

                                    swal({
                                        type: 'success',
                                        text: result.SuccessMsg,
                                        title: 'Alerta!',
                                        showConfirmButton: true,
                                    });
                                }
                            },
                            error: function () {
                                console.log("fallo");
                                swal({
                                    type: 'error',
                                    title: result.SuccessMsg,
                                    showConfirmButton: true,
                                });
                            }
                        });

                    }
                });
            }
        }
    });
</script>


