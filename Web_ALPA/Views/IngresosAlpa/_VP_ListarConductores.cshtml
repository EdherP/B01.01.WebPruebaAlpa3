@using Web_ALPA.Models.Entidad
@model List<Conductor>

<style>
    .size {
        width: 170px;
    }

    .size2 {
        width: 240px;
    }
</style>
<html>
<body>

    <div>
        <table class="table table-striped table-hover" id="kt_table3">
            <thead>
                <tr role="row">
                    <th class="text-dark">#</th>
                    <th class="text-dark">Empresa</th>
                    <th class="text-dark">T.Doc</th>
                    <th class="text-dark">#Documento</th>
                    <th class="text-dark">Conductor</th>
                    <th class="text-dark" style="text-align:center">Cuestionario</th>
                    <th class="text-dark" style="text-align:center">Vacunación</th>
                    <th class="text-dark" style="text-align:center">SCTR</th>
                    <th class="text-dark" style="text-align:center">Licencia</th>
                    <th class="text-dark">Validación ALPA</th>
                    <th class="text-dark" style="text-align:center">Activo</th>
                    <th class="text-dark" style="text-align:center">...</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Count > 0)
                {
                    for (int i = 0; i < Model.Count; i++)
                    {
                        int @Code = Convert.ToInt32(Model[i].U_IdTx);
                        string @DirCuestionario = Model[i].U_DirCuestionario;
                        string @DirVacuna = Model[i].U_DirVacunacion;
                        string @DirSCTR = Model[i].U_DirSCTR;
                        string @DirLicenciaConducir = Model[i].U_DirLicenciaConducir;
                        string @DescEstadoDocs = Model[i].DescEstadoDocs;
                        string @Personal = Model[i].U_ApellidoNombre;
                        <tr>
                            <td>
                                @Html.HiddenFor(x => Model[i].Nro)
                                @Html.DisplayFor(x => Model[i].Nro, Model[i].Nro)
                            </td>
                            <td>
                                @Html.HiddenFor(x => Model[i].U_Empresa)
                                @Html.DisplayFor(x => Model[i].U_Empresa, Model[i].U_Empresa)
                            </td>
                            <td>
                                @Html.HiddenFor(x => Model[i].U_TipoDesc)
                                @Html.DisplayFor(x => Model[i].U_TipoDesc, Model[i].U_TipoDesc)
                            </td>

                            <td>
                                @Html.HiddenFor(x => Model[i].U_DocIdentidad)
                                @Html.DisplayFor(x => Model[i].U_DocIdentidad, Model[i].U_DocIdentidad)
                            </td>
                            <td>
                                @Html.HiddenFor(x => Model[i].U_ApellidoNombre)
                                @Html.DisplayFor(x => Model[i].U_ApellidoNombre, Model[i].U_ApellidoNombre)
                            </td>

                            <td style="text-align:center">
                                @if (Model[i].U_Cuestionario == true)
                                {
                                    <a href="#" onclick="myFunction_RpteWeb('@DirCuestionario')" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-check"></i>
                                    </a>
                                }
                                else
                                {
                                    <a href="#" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-close"></i>
                                    </a>
                                }
                            </td>

                            <td style="text-align:center">
                                @if (Model[i].U_Vacunacion == true)
                                {
                                    <a href="#" onclick="myFunction_RpteWeb('@DirVacuna')" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-check"></i>
                                    </a>
                                }
                                else
                                {
                                    <a href="#" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-close"></i>
                                    </a>

                                }

                            </td>
                            <td style="text-align:center">
                                @if (Model[i].U_SCTR == true)
                                {
                                    <a href="#" onclick="myFunction_RpteWeb('@DirSCTR')" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-check"></i>
                                    </a>
                                }
                                else
                                {
                                    <a href="#" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-close"></i>
                                    </a>

                                }
                            </td>
                            <td style="text-align:center">
                                @if (Model[i].U_LicenciaConducir == true)
                                {
                                    <a href="#" onclick="myFunction_RpteWeb('@DirLicenciaConducir')" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-check"></i>
                                    </a>
                                }
                                else
                                {
                                    <a href="#" class="btn btn-clean btn-sm btn-icon">
                                        <i class="la la-close"></i>
                                    </a>

                                }
                            </td>
                            <td>
                                @if (Model[i].U_EstadoDocs == 1)
                                {
                                    <a href="#ModalValidarDocs2" class="btnValidarDocs2" id="btnValidarDocs2" data-toggle="modal" data-Code="@Code" data-Personal="@Personal">
                                        <span class="kt-badge kt-badge--dark kt-badge--dot"></span><span class="kt-font-bold kt-font-dark"> @DescEstadoDocs </span>

                                    </a>
                                }

                                @if (Model[i].U_EstadoDocs == 2)
                                {
                                    <span class="kt-badge kt-badge--danger kt-badge--dot"></span><span class="kt-font-bold kt-font-danger"> @DescEstadoDocs </span>

                                }

                                @if (Model[i].U_EstadoDocs == 3)
                                {
                                    <span class="kt-badge kt-badge--brand kt-badge--dot"></span><span class="kt-font-bold kt-font-brand"> @DescEstadoDocs </span>
                                }
                            </td>

                            <td style="text-align:center">
                                @if (Model[i].U_FlagActivo == true)
                                {
                                    <span class="kt-font-bold kt-font-brand">SI</span>
                                }
                                else
                                {
                                    <span class="kt-font-bold kt-font-danger">NO</span>
                                }

                            </td>

                            <td style="text-align:center">
                                <a href="#ModalCrearEdit" class="BtnDetCon btn btn-clean btn-sm btn-icon" data-Code="@Code" id="BtnDetCon"
                                   title="Ver detalle" data-toggle="modal">
                                    <i class="fa fa-search"></i>
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    <div class="modal fade" id="ModalValidarDocs2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="exampleModalLongTitle">
                        Validar Documentos
                    </h4>
                </div>
                <div class="modal-body">
                    <form class="kt-form">
                        <div class="kt-portlet__body">
                            <fieldset id="SubmitFormTx">

                                <div style="display:none">
                                    @Html.TextBox("oNroDocumento", "", new { @class = "form-control", @id = "oNroDocumento", @name = "oNroDocumento" })
                                </div>
                                <div class="form-group">
                                    <label>Personal</label>
                                    @Html.TextBox("oPersonalx", null, "", new { @class = "form-control", @disabled = "disabled", @name = "oPersonalx" })
                                </div>

                                <div class="form-group">
                                    <label>Validación</label>
                                    @Html.DropDownList("oEstadoValidacion", ViewBag.ListarValidacion as SelectList, "", new { @class = "form-control", @name = "oEstadoValidacion" })
                                </div>

                                <div class="form-group">
                                    <label>Observación</label>
                                    @Html.TextArea("oObservacionx", new { @class = "form-control", @name = "oObservacionx" })
                                </div>
                            </fieldset>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="btnActValidacion2">
                        Actualizar
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script>
    $(".BtnDetCon").click(function (eve) {
        var XCod = $(this).attr("data-Code");
        var datax = { oCodCon: XCod };
        $.get('/IngresosAlpa/VP_Crear_Conductor', datax).done(function (data) {
            $("#modal-contentCrearEdit").html(data);
        });
    });
    function myFunction_RpteWeb(xDir) {
        window.open(xDir, '_blank');
        window.focus();

    }

    $(document).ready(function () {
        // DataTable
        var table = $('#kt_table3').DataTable({
            /*scrollY: '60vh',*/
            scrollCollapse: true,
            scrollX: true,
            paging: true,
            responsive: false,
            //autoWidth: true,
            //"processing": true,
            //"serverSide": true,
            // Pagination settings
            dom: `<'row'<'col-sm-6 text-left'f><'col-sm-6 text-right'B>>
            <'row'<'col-sm-12'tr>>
            <'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 dataTables_pager'lp>>`,

            buttons: [
                // 'copyHtml5',
                //'excelHtml5',
            ],
            filterable: true,
            pagination: true,
            "language": {
                "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
            },
        });
    });
    $('.btnValidarDocs2').click(function (eve) {

        document.getElementById("oNroDocumento").value = $(this).attr("data-Code");
        document.getElementById("oPersonalx").value = $(this).attr("data-Personal");
    });

    $("#btnActValidacion2").click(function () {
        var button = $(this).find('input[type="submit"]');
        setTimeout(function () {
            button.removeAttr('disabled');
        }, 1);
        $('#progress').show();
        var datax = $("#SubmitFormTx").serialize();
        $.ajax({
            url: '/IngresosAlpa/ActualizarConductorValidacion',
            type: 'post',
            data: datax,
            dataType: 'json',
            success: function (result) {
                $('#progress').hide();
                if (result.EnableSuccess == true) {
                    $("#ModalValidarDocs2").modal('hide');
                    $('body').removeClass('modal-open');
                    $('.modal-backdrop').remove();
                    swal({
                        position: 'top-Rigth',
                        type: 'success',
                        title: result.SuccessMsg,
                        /*showConfirmButton: true,*/
                        timer: 2500
                    });
                    BuscarConductores();
                }
                else {
                    swal({
                        //position: 'top-right',
                        type: 'error',
                        title: 'No Actualizado',
                        text: result.SuccessMsg,
                        showConfirmButton: true,
                    });
                }

            },
        });
    });
</script>

